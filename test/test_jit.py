########################################################################################################################

import unittest

import numpy as np

from decontamination import jit

########################################################################################################################

@jit.jit(device = False)
def foo_xpu(a, b):

    return a + b

########################################################################################################################

# noinspection PyUnresolvedReferences
class JITTests(unittest.TestCase):

    ####################################################################################################################

    def test1(self):

        print('Running foo_xpu...')

        a = np.array([1, 2, 3, 4])
        b = np.array([5, 6, 7, 8])
        c = np.array([6, 8, 10, 12])

        self.assertTrue(np.array_equal(foo_xpu(a, b), c))

    ####################################################################################################################

    def test2(self):

        if jit.CPU_OPTIMIZATION_AVAILABLE:

            print('Running foo_cpu...')

            a = np.array([1, 2, 3, 4])
            b = np.array([5, 6, 7, 8])
            c = np.array([6, 8, 10, 12])

            self.assertTrue(np.array_equal(foo_cpu(a, b), c))

    ####################################################################################################################

    def test3(self):

        if jit.GPU_OPTIMIZATION_AVAILABLE:

            print('Running foo_gpu...')

            a = np.array([1, 2, 3, 4])
            b = np.array([5, 6, 7, 8])
            c = np.array([6, 8, 10, 12])

            self.assertTrue(np.array_equal(foo_gpu[(c.size + (32 - 1)) // 32, 32](a, b), c))

########################################################################################################################

if __name__ == '__main__':

    unittest.main()

########################################################################################################################
